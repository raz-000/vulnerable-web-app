name: Deploy Vulnerable Application                                  # workflow name

on:
  pull_request:
    branches:
      - master
jobs:
  security:
    name: deploy-sast
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Run Snyk to check for vulnerabilities
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SYNK_API_KEY }}
        with:
          args: --file=package.json --sarif-file-output=snyk.sarif
      # - name: Sarif File
      #   uses: snyk/actions/node@master
      #   env:
      #     SNYK_TOKEN: ${{ secrets.SYNK_API_KEY }}
      #   with:      
      #       args: --sarif-file-output=snyk.sarif 
      - name: Upload result to GitHub Code Scanning
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: snyk.sarif

  deploy-heroku:
    name: Deploy-Heroku
    runs-on: ubuntu-latest
    needs: security
    steps:
      - uses: actions/checkout@v2
      - uses: akhileshns/heroku-deploy@v3.12.12 # This is the action
        with:
          heroku_api_key: ${{secrets.HEROKU_API_KEY}}
          heroku_app_name: "hackademyappinsecure" #Must be unique in Heroku
          heroku_email: "ricardo.almario@gmail.com"
          remote_branch: "master"
          usedocker: true
        